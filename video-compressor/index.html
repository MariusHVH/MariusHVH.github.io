<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8MB Video Compressor</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 50px; }
#drop { border: 2px dashed #666; padding: 50px; cursor: pointer; }
#progress { width: 80%; height: 20px; border: 1px solid #666; margin: 20px auto; }
#progress div { height: 100%; background: green; width: 0%; }
</style>
</head>
<body>

<h1>8MB Video Compressor</h1>
<div id="drop">Click or Drop Video Here</div>
<button id="compressBtn">Compress to 8MB</button>
<div id="progress"><div></div></div>
<a id="downloadLink" style="display:none;">Download Compressed Video</a>

<script src="ffmpeg.min.js"></script>
<script>
const ffmpeg = FFmpeg.createFFmpeg({ log: true });
let videoFile;

document.getElementById('drop').addEventListener('click', () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'video/*';
  input.onchange = e => videoFile = e.target.files[0];
  input.click();
});

document.getElementById('compressBtn').addEventListener('click', async () => {
  if (!videoFile) return alert('Please select a video first!');
  
  const progressBar = document.querySelector('#progress div');
  
  // Load FFmpeg and point wasmURL to CDN
  if (!ffmpeg.isLoaded()) await ffmpeg.load({ 
    coreURL: 'ffmpeg-core.js', 
    wasmURL: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/ffmpeg-core.wasm' 
  });

  ffmpeg.setProgress(({ ratio }) => {
    progressBar.style.width = Math.round(ratio * 100) + '%';
  });

  const name = 'input.mp4';
  ffmpeg.FS('writeFile', name, new Uint8Array(await videoFile.arrayBuffer()));
  
  // compress video
  await ffmpeg.run('-i', name, '-b:v', '8000k', '-bufsize', '8000k', 'output.mp4');
  
  const data = ffmpeg.FS('readFile', 'output.mp4');
  const blob = new Blob([data.buffer], { type: 'video/mp4' });
  
  const downloadLink = document.getElementById('downloadLink');
  downloadLink.href = URL.createObjectURL(blob);
  downloadLink.download = 'compressed.mp4';
  downloadLink.style.display = 'block';
});
</script>
</body>
</html>
